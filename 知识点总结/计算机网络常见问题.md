# 计算机网络常见问题

---

 - 网络的几种分层体系结构  
   答：7层网络结构，由上往下分别为应用层、表示层、会话层、传输层、网络层、链路层、物理层。
     
 - 建立TCP服务器的各个系统调用  
   答：socket()、bind()、listen()、accept()、recieve()\send()或read()\write()。  
   socket()：开启一个套接字  
   bind()：绑定IP地址和端口号，注意绑定的时候，服务器一般是要主动绑定IP地址和端口号的，但是客户端一般是不需要的，因为客户端发送连接的时候，内核会自动分配一个端口号给它。  
   listen()：监听是否有客户端请求  
   accept()：阻塞进程，等待客户端的接入，接入之后产生收发的另外一个套接字，注意客户端的地址和端口号是在accept接收到的参数中找到的  
   send()：有客户端的接入之后，发送数据  
   receive()：有客户端接入之后，接收数据  
   close()：关闭套接字  
     
 - 建立TCP客户端的各个系统调用  
   答：socket()、connect()、recv()\send()或read()\write()。  
   connect()：客户端主动连接函数，调用这个函数的时候，会添加自己客户端的地址和端口号  
     
 - socket网络编程有哪些系统调用？其中close是一次就能直接关闭的吗，半关闭状态是怎么产生的？  
   答：socket()、bind()、listen()、accept()、recv()\send()或read()\write()、connect()、close()、shutdown()。半关闭-close()并不是一次就能直接关闭，调用close只能将套接字的引用计数减1，可能其他进程还在使用这个套接字，所以并不是直接关闭。半关闭-在TCP协议中，发送关闭请求时，需要对方回复确认请求，否则不能确认，就会造成一个办半关闭的状态，这个时候可以接收，不能发送。  
     
 - MTU和MSS  
   答：MSS是最大报文段长度，TCP通常设定为MTU-40字节(20byteTCP头+20byteIP头)，如果超过这个大小，TCP会执行分片操作；MTU是最大传输单元，由硬件决定，以太网的最大传输单元为1500字节。  
     
 - 对路由协议的了解与介绍  
   答：内部网关协议(IGP)包括RIP，OSPF，和外部网关协议EGP和BGP。
   
 - 路由协议所使用的算法  
   答：RIP：基于距离向量的路由协议，通过计算距离来选择路由的路径；OSPF：基于链路状态型的路由，给每一个路径有一个权重，并计算路径的代价最小值，选择这条路径；EGP：外部网关协议；BGP：一种常见的外部网关协议，一种矢量的路由协议，它通过维护IP路由表或‘前缀’表来实现自治系（AS）之间的可达性。算法-最短路径算法？找到最短的路由路径。。。    
   
 - 路由表的项目包括哪些  
   答：目的网络地址、掩码、下一跳路由器的入口ip地址、本地路由器的出口ip地址、到达目的地址的跳数、路由的优先级。
   
 - 地址解析协议ARP的过程  
   答：路由器收到一个数据报文后，首先确认其转发路径的ip，之后在自己的arp表中搜索有没有该IP地址对应的MAC，如果找到直接使用该mac地址打包数据报文；若没有找到，则发布一个广播帧，询问子网中的所有设备，哪个设备的IP是该IP，只有该IP地址的设备应答这个广播帧，并返回MAC，路由器使用该MAC打包数据报文，并将此MAC-IP对记录在arp表中。
     
 - 网际控制报文协议ICMP的过程
   
 - 动态主机配置协议DHCP的过程  
   答：1) DHCP服务器部署好后，DHCP客户端发送广播报文寻找DHCP服务器，源地址0.0.0.0、目的地址255.255.255.255；2) 只有DHCP服务器会响应这个报文，并从地址池中查找是否有合适的ip地址，如果有就告诉DHCP客户端可以下一步操作；3) DHCP客户端向服务器请求ip地址、掩码、网关等信息；4) DHCP服务器接受到请求，向该客户端返回可用的ip地址等，如果客户端将于其它网卡绑定，则服务器收回ip地址等；5) 当DHCP客户端重新登录到服务器，先尝试以以前地址向服务器请求，如果之前地址无法继续使用，重新进入1)阶段；6) DHCP客户端可通过DHCP Renew来获取新的端口号。
   
 - WAN LAN WLAN VLAN VPN的区别  
   答：WAN-广域网是一种跨越大的地域性的计算机网络；LAN-局域网是一种较小的计算机网络；WLAN-无线局域网；VLAN-虚拟局域网是可灵活划分不同的逻辑子网；VPN-虚拟专用网络，在公用网络上建立专用网络，进行加密通讯。
   
 - 介绍一下VPN（虚拟专用网）  
   答：虚拟专用网络功能是：在公用网络上建立专用网络，进行加密通讯；VPN 网关通过对数据包的加密和数据包目标地址的转换实现远程访问；vpn按层次划分可分为链路层隧道、网络层隧道、会话层隧道、应用层隧道，链路层隧道-pptp协议、网络层隧道-IPSec协议、会话层隧道-SOCKS VPN、应用层隧道-SSL VPN；主要是IPSec建立VPN。
   
 - TCP和UDP的区别  
   答：TCP是面向连接、字节流、可靠传输的；UDP是不面向连接、数据报、不保证可靠性传输的。  
     
 - TCP如何保证数据的正确性  
   答：序列号-保证数据的有序性；超时重传-保证数据的正确性；流量控制-避免数据丢失；拥塞控制-保证网络的流畅性；首部校验-保证数据的正确性，但首部校验无法保证数据完全正确，因为a+b=b+a，数据刚好颠倒也有可能使校验通过，因此可以在校验的基础上加密，使出错的概率大大降低。
     
 - TCP和UDP相关的协议与端口号  
   答：TCP传输的应用层HTTP-80、HTTPS-443、FTP-20和21、SMTP-25、POP3-110；UDP传输的应用层DNS-53、DHCP-67和68、SNMP-161和162。
     
 - TCP（UDP，IP）等首部的认识（http请求报文构成）  
   答：TCP首部长度40byte+扩展长度40byte，里面主要由源端口号、目的端口号、序列号、确认号、头部长度、缓冲窗口大小、首部校验和、紧急指针、扩展选项组成；UDP首部长度8byte，里面主要由源端口号、目的端口号、长度、校验和组成。
   
 - 网络层分片(IP分片)的原因与具体实现  
   答：因为不同子网间定义的MSS大小不同，如果大的MSS进入小的MSS子网则需要分片，不然会导致网络阻塞；实现：ip分片后使用相同的源ip和目的ip，但是其ip首部中将记录该分片属于原ip的偏移量，并且同一ip的分片具有相同的id号；到达目的ip地址后，通过ip首部的信息重新合成原来的数据报文。
     
 - TCP的三次握手与四次挥手的详细介绍（TCP连接建立与断开是热门问题）  
   答：第一次握手：建立连接时，客户端发送syn包（序列号syn=j）到服务器，并进入SYN_SENT状态，等待服务器确认；第二次握手：服务器收到syn包，必须确认客户的SYN（确认号ack=j+1），同时自己也发送一个SYN包（序列号syn=k），即SYN+ACK包，此时服务器进入SYN_RECV状态；第三次握手：客户端收到服务器的SYN+ACK包，向服务器发送确认包ACK(确认号ack=k+1），此包发送完毕，客户端和服务器进入ESTABLISHED状态，完成三次握手，TCP连接成功。
     
 - TCP握手以及每一次握手客户端和服务器端处于哪个状态（11种状态）  
   答：1)、LISTEN:首先服务端需要打开一个socket进行监听，状态为LISTEN.
       2)、SYN_SENT:客户端通过应用程序调用connect进行active open.于是客户端tcp发送一个SYN以请求建立一个连接.之后状态置为SYN_SENT.
       3)、SYN_RECV:服务端应发出ACK确认客户端的SYN,同时自己向客户端发送一个SYN. 之后状态置为SYN_RECV
			 4)、ESTABLISHED: 代表一个打开的连接，双方可以进行或已经在数据交互了。
	   	 5)、FIN_WAIT1:主动关闭(active close)端应用程序调用close，于是其TCP发出FIN请求主动关闭连接，之后进入FIN_WAIT1状态.
	   	 6)、CLOSE_WAIT:被动关闭(passive close)端TCP接到FIN后，就发出ACK以回应FIN请求(它的接收也作为文件结束符传递给上层应用程序),并进入CLOSE_WAIT.
	   	 7)、FIN_WAIT2:主动关闭端接到ACK后，就进入了FIN-WAIT-2 .
	   	 8)、LAST_ACK:被动关闭端一段时间后，接收到文件结束符的应用程序将调用CLOSE关闭连接。这导致它的TCP也发送一个 FIN,等待对方的ACK.就进入了LAST-ACK . 
	   	 9)、TIME_WAIT:在主动关闭端接收到FIN后，TCP就发送ACK包，并进入TIME-WAIT状态。
	   	10)、CLOSING: 这种状态比较特殊，实际情况中应该是很少见，属于一种比较罕见的例外状态。正常情况下，当你发送FIN报文后，按理来说是应该先收到（或同时收到）对方的 ACK报文，再收到对方的FIN报文。但是CLOSING状态表示你发送FIN报文后，并没有收到对方的ACK报文，反而却也收到了对方的FIN报文。什 么情况下会出现此种情况呢？其实细想一下，也不难得出结论：那就是如果双方几乎在同时close一个SOCKET的话，那么就出现了双方同时发送FIN报 文的情况，也即会出现CLOSING状态，表示双方都正在关闭SOCKET连接。
	   	11)、CLOSED: 被动关闭端在接受到ACK包后，就进入了closed的状态。连接结束  
     
 - TCP的半关闭状态  
   答：当主动关闭方收到被动关闭方对于FIN请求的响应，则TCP连接进入半关闭状态；在socket编程中对应与shutdown函数。
     
 - TCP的半打开状态  
   答：当服务器(或者客户端)因异常终止了连接而没有发送FIN报文，客户端(或服务器)还维持原来的连接，但服务器(或客户端)重启后已没有了该连接的信息，此时TCP连接处于半打开状态。  
     
 - 为什么使用三次握手，两次握手可不可以？  
   答：不用四次握手，因为如果四次握手的话，第二次和第三次握手并无功能上的联系，所以可以将两次握手合并；两次握手可能会导致资源浪费的问题，假设客户端在发送完请求后，服务器的响应报文因为网络延迟而没有在规定时间到达客户端，客户端认为此次申请失败，进行超时重传，与服务器建立新的连接；此时迟到的响应报文到达客户端，因为客户端认为上次的申请失败，该响应报文会被丢弃，但是服务器会一直为此连接保留资源。
     
 - TIME_WAIT的意义（为什么要等于2MSL）  
   答：TIME_WAIT状态是主动关闭方会进入的状态，当主动关闭方发送了对被动关闭方的FIN请求的响应后进入；MSL的建议时间为2min，可修改；  
   原因：1)保证TCP可靠终止，若响应报文丢失，被动关闭方重传的FIN请求可以被主动关闭方再次接收；2)因为TCP端口可重复使用，2MSL可以保证上一个TCP通信中的报文全部消失而不至于影响下一个使用同端口号的TCP通信。  
     
 - 超时重传机制(不太高频)  
   答：Linux下超时重连机制——维持一个重连定时器，每次重连失败会将定时器的定时时间加倍，尝试重连5次均失败则关闭当前TCP连接，如1s-2s-4s-8s-16s-32s。  
   
 - TCP怎么保证可靠性（面向字节流，超时重传，应答机制，滑动窗口，拥塞控制，首部校验等）？  
			答：1.面向字节流：以流的方式传输，缓存区满了就划分为几段进行传输；2.超时重传：发送数据包在一定的时间周期内没有收到相应的ACK，等待一定的时间，超时之后就认为这个数；3.据包丢失，就会重新发送；4.应答机制：3次握手和4次挥手；5.滑动窗口：控制发送方发送窗口的大小，控制流量；6.拥塞控制：控制传输上流量；7.校验：防止数据传输过长中发生的错误。  
	  
 - TCP滑动窗口协议  
   答：发送窗口和接收窗口，糊涂窗口综合症（发送窗口一直为1，网络中的有效数据占比低），死锁（发送窗口开始为0，但后面其不为0的响应报文丢失）。
     
 - 拥塞控制和流量控制的区别  
   答：流量控制针对的是两个端口之间的数据传输，而拥塞控制是对整个网络的调整。
     
 - TCP拥塞控制，算法名字？（极其重要）  
   答：慢启动与拥塞避免、快重传与快恢复；拥塞窗口、慢启动门限；判断出现拥塞的依据——出现超时重传(慢启动与拥塞避免)、接收到连续重复的报文(快重传与快恢复)；  
     
 - 网页解析的过程与实现方法  
   答：1.用户输入网址（假设是个html页面，并且是第一次访问），浏览器向服务器发出请求，服务器返回html文件；2.浏览器开始载入html代码，发现标签内有一个标签引用外部CSS文件；3.浏览器又发出CSS文件的请求，服务器返回这个CSS文件；4.浏览器继续载入html中部分的代码，并且CSS文件已经拿到手了，可以开始渲染页面了；5.浏览器在代码中发现一个标签引用了一张图片，向服务器发出请求。此时浏览器不会等到图片下载完，而是继续渲染后面的代码；6.服务器返回图片文件，由于图片占用了一定面积，影响了后面段落的排布，因此浏览器需要回过头来重新渲染这部分代码；7.浏览器发现了一个包含一行Javascript代码的；8.Javascript脚本执行了这条语句，它命令浏览器隐藏掉代码中的某个；9.终于等到了的到来，浏览器泪流满面…… 10.等等，还没完，用户点了一下界面中的“换肤”按钮，Javascript让浏览器换了一下＜link＞标签的CSS路径；11.浏览器召集了在座的各位们，“大伙儿收拾收拾行李，咱得重新来过……”，浏览器向服务器请求了新的CSS文件，重新渲染页面。  
     
 - 在浏览器中输入URL后执行的全部过程
   答：浏览器得到url，首先看本地是否缓存有此URL的ip，若没有就向DNS服务器请求解析此URL得到IP地址（涉及递归查找和迭代查找）；解析出IP地址后，根据IP地址和服务端口号找到服务器，并与服务器建立TCP连接（ARP、路由跳转、三次握手）；浏览器发出HTTP请求获取服务器的资源；服务器响应请求，返回HTML文本给浏览器；一次HTTP通信结束（四次挥手）；浏览器解析html文件，显示内容。  
   
 - 应用层协议常用的端口号  
   答：HTTP：80，HTTPS：443，DNS：53，FTP：20和21，SMTP：25，POP3:110等。
     
 - http协议与TCP联系  
   答：要进行http通信，必须先建立TCP连接；http1.0时一次http连接需建立一次tcp连接，所以握手开销比较大，后续http1.1增加长连接，可以在一次tcp连接中进行多次http通信。  
   
 - http/1.0和http/1.1的区别  
   答：http/1.1新特性-长连接，首部和主体请求分开（节约带宽），可建立多个TCP连接并行传输，缓存处理实现文件的断点续传。  
     
 - http的请求方法有哪些？get和post的区别。  
   答：get put post option head trace；get和post的区别-1.get通过url传递全部信息，服务器成功返回200，而post先发送header，再发送data，服务器分别返回100和200；2.get只能进行url编码，而post的data可以使用不同的编码方式；3.get记录会保存在浏览历史记录中，post中的参数不会被保留；4.get产生一个tcp包，post产生两个tcp包。  
   
 - http的状态码  
   答：1xx：继续操作； 2xx：操作成功； 3xx：重定向； 4xx：客户端错误；5xx：服务器错误。  
     
 - http和https的区别，由http升级为https需要做哪些操作  
   答：在建立tcp连接后和建立http连接前，完成ssl加密握手。  
     
 - https的具体实现，怎么确保安全性  
   答：ssl握手过程：1. 客户端发起https连接请求，并将自身支持的加密算法发送到服务器；2. 服务器响应请求，从加密算法中选择一种告诉客户端；3. 服务器将自己的数字证书发送给客户端(里面含有服务器的公钥)；4. 服务器发送协商结束报文；5. 客户端用认证机构(CA)的公钥解密数字证书，确认服务器的身份并取得其公钥，采用协商的加密算法(产生对称加密的密钥)并用公钥加密传输给服务器；6. 客户端告诉服务器以后使用此共享密钥进行加密传输；7. 服务端使用私钥对含有共享密钥的密文进行解密，获得共享密钥；8. 服务器和客户端开始进行加密传输。  
     
 - 在浏览器输入一个URL的流程，这个过程中浏览器做了什么（如www.baidu.com）  
   答：见上面类似问题。  
     
 - URL包括哪三个部分？  
   答：应用层协议 + 域名 + 端口号 + 文件路径。  
     
 - 长连接与短连接的区别以及使用场景  
   答：长连接-在http通信建立tcp连接后可以保持这个连接直到不需要再关闭；短连接-http通信建立tcp连接后完成本次通信后即关闭连接。tcp长连接优缺点：长连接可以省去较多的tcp建立/关闭的操作，减少浪费，节省时间，对于频繁请求资源的客户，较适用于长连接，但随着并发数增多，服务器将无法负担；tcp短连接优缺点：短连接对于服务器来说较为简单，存在的连接都是有用的连接，不需要额外的控制，但如果客户端连接频繁，会在tcp的建立和关闭上浪费时间。长连接适用于聊天室、实时游戏等通信频繁的场景；短连接适用于网页浏览等刷新率低的场景。  
     
 - **一个机器能够使用的端口号上限是多少，为什么？可以改变吗？那如果想要用的端口超过这个限制怎么办？**  
   答：linux socket使用16bit无符号整型表示端口号，最大到65535，不能改变，规定了是16bit二进制数，但是可以复用，即使用同一个端口号来进行通信。  
     
 - 介绍一下ping的过程，分别用到了哪些协议  
   答：ping是测试网络常用指令，基于ICMP协议；过程-1.ping通知系统建立一个固定格式的ICMP请求报文；2.IP层协议添加IP报文头构建IP数据报；3.获取下一跳路由的ip地址，查询arp表或通过arp协议获取该路由的mac地址，构建链路层数据帧，以此类推直到到达ping的地址；4.目的设备收到数据帧后，对比目的mac地址判断是否是发送到自己的数据帧，是则解析数据帧提取ip数据和ICMP请求数据，之后构建ICMP应答包，通过同样的过程返回。  
   
 - 对称密码和非对称密码体系  
	 答：1．对称密钥密码体系-也叫密钥密码体系，它是指消息发送方和消息接收方必须使用相同的密钥，该密钥必须保密。发送方用该密钥对待发消息进行加密，然后将消息传输至接收方，接收方再用相同的密钥对收到的消息进行解密；2.非对称密钥密码体系-公钥密码体系，它使用两个密钥：一个公共密钥PK和一个私有密钥SK。这两个密钥在数学上是相关的，并且不能由公钥计算出对应的私钥，同样也不能由私钥计算出对应的公钥。  
	   
 - 数字证书的了解（高频）  
   答：数字证书是经过权威机构（CA）认证的公钥，通过查看数字证书，可以知道该证书是由那家权威机构签发的，证书使用人的信息，使用人的公钥。它有以下特点：1、由专门的机构签发的数字证书才安全有效。2、签发数字证书是收费的。3、不会被冒充，安全可信。4、数字证书有使用期限，过了使用期限，证书变为不可用。CA也可以在试用期内，对证书进行作废操作。
 
 - 客户端为什么信任第三方证书  
   答：第三方认证机构，是指具有可靠的执行认证制度的必要能力，并在认证过程中能够客观、公正、独立地从事认证活动的机构。即认证机构是独立于制造厂、销售商和使用者（消费者）的、具有独立的法人资格的第三方机构，故称认证为第三方认证认证机构。
    
 - RSA加密算法（非对称加密，用公匙和私匙实现）  
   答：MD5原理：MD5，全名Message Digest Algorithm 5，是一种摘要算法，通过内置的hash算法将信息摘要成为定长的十六进制字串；RSA加密算法：与DES不同，RSA算法中，每个通信主体都有两个钥匙，一个公钥一个私钥。就是有2把钥匙：使用publicKey可以对数据进行加密，使用私钥才能对数据进行解密。  
      
 - 单条记录高并发访问的优化  
   答：1.保证在实现功能的基础上，尽量减少对数据库的访问次数；2.通过搜索参数，尽量减少对表的访问行数,最小化结果集，从而减轻网络负担；3.能够分开的操作尽量分开处理，提高每次的响应速度；4.在数据窗口使用SQL时，尽量把使用的索引放在选择的首列；算法的结构尽量简单。  
     
 - 数据流和粘包问题  
   答：Nagle算法会将数据量较小的报文缓存起来，等确认到来时一次性发出，以减少网络拥塞出现的概率。  
     
 - 一台机器最多可以建立多少tcp连接？  
   答：客户端有多少可用端口号就可以建立多少tcp连接，不考虑端口号就是2的16次方即65535个；而服务器的监听端口只有一个，所以其可建立连接数为ip号x端口号=2的32次方x2的16次方=2的48次方。    
     
 - 五种IO模型的过程和比较
 - IO多路复用（select，poll，epoll的区别）
 - 有没有抓过TCP包，描述一下  
   
 - 一个ip配置多个域名，靠什么识别？  
   答：依靠HTTP首部的host字段，该字段保存有域名。  
     
 - 服务器攻击（DDos攻击）  
   答：分布式拒绝服务攻击，强调是将多个计算机联合起来作为攻击平台，对一个或多个目标发动DDoS攻击，从而成倍地提高拒绝服务攻击的威力。大量恶意的流量去访问同一个服务器，导致服务器处理不过来，功能瘫痪。  
      
 - 重放攻击，IP欺骗
